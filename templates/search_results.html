{% extends 'base.html' %}
{% block content %}
<form id="alt-search">
    <div>
        <h5>Where are you going next?:</h5>
            <input id= "city-search-alt" type="text" name="city_search" required>
            <input id="search-button-alt" type="submit" value="Search">
    </div>
</form>
    <div>
        <h6>Sort By:</h6>
            <form id="sort-form">
                <input type="button" id="sort-default" class="sort-btn" value="Default">
                <input type="button" id="sort-least-pop" class="sort-btn" value="Hidden Treasures">
                <input type="button" id="sort-name" class="sort-btn" value="Name">
            </form>
    </div>

    <div>
        <h2>Results:</h2>
        <div id="results-list">
            <ul id="place-results">
                {% for place in places %}
                    <div>
                        <li>
                            <a href="/places/{{ place.place_id }}">{{ place.name }}</a>
                            <div> Tag:
                                {% for tag in place.tags %}
                                    {{ tag.tag_name }}.
                                {% endfor %}
                            </div>
                            <div>Rating: {{place.rating}}</div>                        
                            <form id="add-action-form">
                                <input type="button" id="sav-{{ place.place_id }}" class="sav" value="Bookmark">
                                <input type="button" id="hbh-{{ place.place_id }}" class="hbh" value="I've been here">
                            </form>
                        </li>
                    </div>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div id="results-map"></div>

<!-- FOR ALL BUTTONS -->
<script>

function showConfirmation(result) {
    console.log(result);
    if (result.result_code == "login"){
        console.log(this.id);
        window.location.href = "/login";
    } else if (result.result_code == "added"){
        $(this.id).addClass("selected");
        console.log(this.id);
    } else{
        $(this.id).removeClass("selected");
        console.log(this.id);
    }
}

function updateActionTable(evt){
    evt.preventDefault();
    console.log(this.classList[0]+" button has been clicked.");

    var formInputs = {
        "action_type": this.classList[0],
        "place_id": this.id.slice(4)
    };

    console.log("type: "+this.classList[0]);
    console.log("placeid: "+this.id.slice(4));

    $.post("/add-action", 
           formInputs,
           showConfirmation
           );
}

$(".sav").on("click", updateActionTable)
$(".hbh").on("click", updateActionTable)

</script>

<script>

function showResults(res_list){
    $("#place-results").remove();
    $('#results-list').append("<ul id='place-results'> <div id='data_goes_here'> <div> </ul>");
    var i;
    var j;
    for (i = 0; i < res_list.length; i++) {
        $('#data_goes_here').append("<li> <a href='/places/"+ res_list[i].place_id + "'>" + res_list[i].name + "</a> <div id='tag-div-"+ res_list[i].place_id +"'> Tag: </div> <div>Rating: " + res_list[i].rating + "</div> <form id='add-action-form'> <input type='button' id='sav-" + res_list[i].place_id + "' class='sav' value='Bookmark'> <input type='button' id='hbh-" + res_list[i].place_id + "' class='hbh' value='Been here'> </form> </li>");   
        console.log(res_list[i].tags)
        $('#tag-div-'+res_list[i].place_id).append(res_list[i].tags);
    }
}

function submitSearch(evt){
    evt.preventDefault();
    console.log("after prevent");

    var formInputs = {
        "city_search": $("#city-search-alt").val()
    };

    $.post('/search.json',
            formInputs,
            showResults);
}

$("#search-button-alt").on('click', submitSearch);
    
</script>


{% endblock %}

